(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();const x=new Map;function u(t,r){x.set(t,r)}function S(t){return x.get(t)}function T(t){const r=x.get(t);return r?r.name:"—"}function R(t){return(r,a)=>{const{width:o,height:e,data:n}=r,c=a.data;for(let s=0;s<e;s++)for(let l=0;l<o;l++){let i=0,f=0,v=0,d=0,p=0;for(let I=-t;I<=t;I++)for(let E=-t;E<=t;E++){const A=Math.min(o-1,Math.max(0,l+E)),L=(Math.min(e-1,Math.max(0,s+I))*o+A)*4;i+=n[L],f+=n[L+1],v+=n[L+2],d+=n[L+3],p++}const w=(s*o+l)*4;c[w]=i/p,c[w+1]=f/p,c[w+2]=v/p,c[w+3]=d/p}}}const F=R(2),K=R(4),q=R(8);function U(t,r,a){return(o,e)=>{const n=o.data,c=e.data;for(let s=0;s<n.length;s+=4)c[s]=t?n[s]:0,c[s+1]=r?n[s+1]:0,c[s+2]=a?n[s+2]:0,c[s+3]=n[s+3]}}function N(t,r,a){return(o,e)=>{const n=o.data,c=e.data;for(let s=0;s<n.length;s+=4){const l=n[s+t],i=n[s+r],f=n[s+a];c[s]=l,c[s+1]=i,c[s+2]=f,c[s+3]=n[s+3]}}}const z=U(!0,!1,!1),X=U(!1,!0,!1),Y=U(!1,!1,!0),Z=N(1,0,2),_=N(0,2,1),$=N(2,1,0);function h(t){return Math.min(255,Math.max(0,Math.round(t)))}const J=(t,r)=>{const a=t.data,o=r.data,e=1.8,n=1.4,c=-30;for(let s=0;s<a.length;s+=4){let l=a[s],i=a[s+1],f=a[s+2];const v=a[s+3],d=.299*l+.587*i+.114*f;l=h((l-d)*e+d),i=h((i-d)*e+d),f=h((f-d)*e+d),l=h((l-128)*n+128+c),i=h((i-128)*n+128+c),f=h((f-128)*n+128+c),o[s]=l,o[s+1]=i,o[s+2]=f,o[s+3]=v}};function b(t){return Math.min(255,Math.max(0,Math.round(t)))}function G(t){return(r,a)=>{const o=r.data,e=a.data;for(let n=0;n<o.length;n+=4){const c=o[n],s=o[n+1],l=o[n+2],i=.299*c+.587*s+.114*l;e[n]=b((c-i)*t+i),e[n+1]=b((s-i)*t+i),e[n+2]=b((l-i)*t+i),e[n+3]=o[n+3]}}}const Q=G(1.8),V=G(.4),tt=(t,r)=>{const{width:a,height:o,data:e}=t,n=r.data,c=a>>1,s=o>>1;for(let l=0;l<o;l++)for(let i=0;i<a;i++){const f=i%c*2,d=(l%s*2*a+f)*4,p=(l*a+i)*4;n[p]=e[d],n[p+1]=e[d+1],n[p+2]=e[d+2],n[p+3]=e[d+3]}},et=(t,r)=>{const a=t.data,o=r.data;for(let e=0;e<a.length;e+=4)o[e]=255-a[e],o[e+1]=255-a[e+1],o[e+2]=255-a[e+2],o[e+3]=a[e+3]},nt=(t,r)=>{const a=t.data,o=r.data;for(let e=0;e<a.length;e+=4){const n=a[e],c=a[e+1],s=a[e+2],l=Math.round(.299*n+.587*c+.114*s);o[e]=l,o[e+1]=l,o[e+2]=l,o[e+3]=a[e+3]}};function at(){u(1,{name:"Blur light",apply:F}),u(2,{name:"Blur medium",apply:K}),u(3,{name:"Blur heavy",apply:q}),u(4,{name:"Red channel only",apply:z}),u(5,{name:"Green channel only",apply:X}),u(6,{name:"Blue channel only",apply:Y}),u(7,{name:"Swap R–G",apply:Z}),u(8,{name:"Swap G–B",apply:_}),u(9,{name:"Swap R–B",apply:$}),u(10,{name:"Deep fry",apply:J}),u(11,{name:"Saturation up",apply:Q}),u(12,{name:"Saturation down",apply:V}),u(13,{name:"Split into 4",apply:tt}),u(14,{name:"Invert",apply:et}),u(15,{name:"Grayscale",apply:nt})}const rt=50;let D=null;const y=[];function C(){return D}function H(t){D=t}function ot(){if(!D)return;const t=lt(D);y.push(t),y.length>rt&&y.shift()}function st(){if(y.length===0)return!1;const t=y.pop();return t&&(D=t),!0}function ct(){y.length=0}function lt(t){const r=new ImageData(t.width,t.height);return r.data.set(t.data),r}at();const g=document.getElementById("drop-zone"),B=document.getElementById("file-input"),it=document.getElementById("canvas-wrap"),O=document.getElementById("canvas"),ut=document.getElementById("input-area"),m=document.getElementById("command-input"),dt=document.getElementById("effect-name"),P=O.getContext("2d");if(!P)throw new Error("Canvas 2D not available");const M=P;function ft(){g.classList.add("hidden"),it.classList.remove("hidden"),ut.classList.remove("hidden"),m.focus()}function W(t){const r=t.naturalWidth,a=t.naturalHeight;O.width=r,O.height=a,M.drawImage(t,0,0);const o=M.getImageData(0,0,r,a);H(o),ct(),ft()}function j(){const t=C();t&&M.putImageData(t,0,0)}function pt(t){const r=S(t);if(!r)return;const a=C();if(!a)return;ot();const o=new ImageData(a.width,a.height);r.apply(a,o),H(o),j()}function k(){const t=m.value.replace(/\D/g,""),r=t===""?0:parseInt(t,10);dt.textContent=r?T(r):""}m.addEventListener("input",()=>{m.value=m.value.replace(/\D/g,""),k()});m.addEventListener("keydown",t=>{if(t.key==="Enter"){t.preventDefault();const r=m.value.replace(/\D/g,"");if(r==="")return;const a=parseInt(r,10);S(a)&&(pt(a),m.value="",k());return}if(t.key==="Backspace"&&m.value===""){t.preventDefault(),st()&&j();return}});B.addEventListener("change",()=>{var o;const t=(o=B.files)==null?void 0:o[0];if(!(t!=null&&t.type.startsWith("image/")))return;const r=URL.createObjectURL(t),a=new Image;a.onload=()=>{W(a),URL.revokeObjectURL(r)},a.src=r});g.addEventListener("click",t=>{t.target.tagName!=="INPUT"&&B.click()});g.addEventListener("dragover",t=>{t.preventDefault(),g.classList.add("dragover")});g.addEventListener("dragleave",()=>{g.classList.remove("dragover")});g.addEventListener("drop",t=>{var e,n;t.preventDefault(),g.classList.remove("dragover");const r=(n=(e=t.dataTransfer)==null?void 0:e.files)==null?void 0:n[0];if(!(r!=null&&r.type.startsWith("image/")))return;const a=URL.createObjectURL(r),o=new Image;o.onload=()=>{W(o),URL.revokeObjectURL(a)},o.src=a});
